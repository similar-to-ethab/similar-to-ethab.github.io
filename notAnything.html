<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Rotating Game</title>
    <script src="./js/coreClassChanges.js" charset="utf-8"></script>
    <style media="screen">

    :root{
      --time-delay:2s;
    }

    * {
      box-sizing: border-box;
      padding:0;
      /*-moz-user-select: -moz-none;
     -khtml-user-select: none;
     -webkit-user-select: none;

     / *
       Introduced in IE 10.
       See http://ie.microsoft.com/testdrive/HTML5/msUserSelect/
     * /
     -ms-user-select: none;
     user-select: none;*/
    }
      #board {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        width:20px;
        height: 20px;
        background-color: lightblue;
      }

      .quadrant{
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, 1fr);
        height: 33vw;
        width:33vw;
        /*border-style:solid;*/
        border: 1px solid black;
        background-color: lightgrey;
        text-align: center;
      }
      h1 {
        /*border: 1px solid black;*/
        background-color: white;
        margin: auto;
        padding-top:auto;
        width:70%;
        height:70%;
        border-radius: 50%;
        transition: background-color var(--time-delay);
        cursor:pointer;
      }

      .player1clicked {
        background-color: black;
      }
      .player2clicked {
        background-color: blue;
      }

      .playerTurnDiv{
        position: absolute;
        margin:0;
        right: 10%;
        width:15vw;
        height: 10vw;
        border: 1px solid black;
        transition: background-color .5s, color 1s;
      }
      .playerTurn{

        font-size: var(--player-text-size);
        /*padding-top:calc(5vw - (var(--player-text-size)/2));*/
        text-align: center;



      }

      .playerTurn1{
        color:white;
        background-color: black;
        margin-top: 25%;
      }
      .playerTurn2{
        color:lightgrey;
        background-color: blue;
        margin-top: 25%;
      }

      .gameOver1{
        background-color: green;
        color: lightgreen;
        padding:auto;
        margin: 0;
      }
      .gameOver2{
        background-color: green;
        color: lightgreen;
        padding:auto;
        margin: 0;
      }
      #gameOver1, #gameOver2{

      }

    </style>
  </head>
  <body>
<label><button type="button" name="topLeft2" id='topLeft2' onclick="rotate(2,0)">Top Left Twice</button></label>
<label><button type="button" name="topRight2" id='topRight2' onclick="rotate(2,1)">Top Right Twice</button></label>
<label><button type="button" name="bottomLeft2" id="bottomLeft2" onclick="rotate(2,2)">Bottom Left Twice</button></label>
<label><button type="button" name="bottomRight2" id="bottomRight2" onclick="rotate(2,3)">Bottom Right Twice</button></label>


<div class="playerTurnDiv playerTurn1">
  <h2 class='playerTurn' id='playerTurn1'>Player Turn: 1</h2>
</div>




<button type="button" name="button" onclick='boardGrid()'>button</button>
    <div id="board">
      <div class="quadrant" id="quadrant1">
        <h1 class='1x1 000' id='000'>hi</h1><!--  colxrow  -->
        <h1 class='1x2 001' id='001'></h1>
        <h1 class='1x3 002' id='002'></h1>
        <h1 class='1x4 003' id='003'></h1>

        <h1 class='2x1 010' id='010'></h1>
        <h1 class='2x2 011' id='011'></h1>
        <h1 class='2x3 012' id='012'></h1>
        <h1 class='2x4 013' id='013'>hi</h1>

        <h1 class='3x1 020' id='020'></h1>
        <h1 class='3x2 021' id='021'></h1>
        <h1 class='3x3 022' id='022'></h1>
        <h1 class='3x4 023' id='023'></h1>

        <h1 class='4x1 030' id='030'></h1>
        <h1 class='4x2 031' id='031'></h1>
        <h1 class='4x3 032' id='032'></h1>
        <h1 class='4x4 033' id='033'>hi</h1>


      </div>
      <div class="quadrant" id="quadrant2">
        <h1 class='1x1 100' id='100'>hi</h1>
        <h1 class='1x2 101' id='101'></h1>
        <h1 class='1x3 102' id='102'></h1>
        <h1 class='1x4 103' id='103'></h1>

        <h1 class='2x1 110' id='110'></h1>
        <h1 class='2x2 111' id='111'></h1>
        <h1 class='2x3 112' id='112'></h1>
        <h1 class='2x4 113' id='113'>hi</h1>

        <h1 class='3x1 120' id='120'></h1>
        <h1 class='3x2 121' id='121'></h1>
        <h1 class='3x3 122' id='122'></h1>
        <h1 class='3x4 123' id='123'></h1>

        <h1 class='4x1 130' id='130'></h1>
        <h1 class='4x2 131' id='131'></h1>
        <h1 class='4x3 132' id='132'></h1>
        <h1 class='4x4 133' id='133'>hi</h1>
      </div>
      <div class="quadrant" id="quadrant3">
        <h1 class='1x1 200' id='200'>hi</h1>
        <h1 class='1x2 201' id='201'></h1>
        <h1 class='1x3 202' id='202'></h1>
        <h1 class='1x4 203' id='203'></h1>

        <h1 class='2x1 210' id='210'></h1>
        <h1 class='2x2 211' id='211'></h1>
        <h1 class='2x3 212' id='212'></h1>
        <h1 class='2x4 213' id='213'>hi</h1>

        <h1 class='3x1 220' id='220'></h1>
        <h1 class='3x2 221' id='221'></h1>
        <h1 class='3x3 222' id='222'></h1>
        <h1 class='3x4 223' id='223'></h1>

        <h1 class='4x1 230' id='230'></h1>
        <h1 class='4x2 231' id='231'></h1>
        <h1 class='4x3 232' id='232'></h1>
        <h1 class='4x4 233' id='233'>hi</h1>
      </div>
      <div class="quadrant" id="quadrant4">
        <h1 class='1x1 300' id='300'>hi</h1>
        <h1 class='1x2 301' id='301'></h1>
        <h1 class='1x3 302' id='302'></h1>
        <h1 class='1x4 303' id='303'></h1>

        <h1 class='2x1 310' id='310'></h1>
        <h1 class='2x2 311' id='311'></h1>
        <h1 class='2x3 312' id='312'></h1>
        <h1 class='2x4 313' id='313'>hi</h1>

        <h1 class='3x1 320' id='320'></h1>
        <h1 class='3x2 321' id='321'></h1>
        <h1 class='3x3 322' id='322'></h1>
        <h1 class='3x4 323' id='323'></h1>

        <h1 class='4x1 330' id='330'></h1>
        <h1 class='4x2 331' id='331'></h1>
        <h1 class='4x3 332' id='332'></h1>
        <h1 class='4x4 333' id='333'>hi</h1>
      </div>

    </div>

    <script type="text/javascript">

var winningList = [];
var winner;

var playerTurn = 1;
var playerBoxContent = 'Player Turn: ';

const playerTurnDiv = document.getElementsByClassName('playerTurnDiv')[0];
const elPlayer = document.getElementsByClassName('playerTurn')[0];

var blocks = [];
var blockStatus = [];
for (let q = 0; q < 4; q++) {
  blocks[q]=[];
  for (let c = 0; c < 4; c++) {
    blocks[q][c]=[];
    for (let r = 0; r < 4; r++) {
      blocks[q][c][r] = {group:(c+1).toString() + "x" + (r+1).toString(), status:0, oldStatus:0};
      blocks[q][c][r].el = document.getElementById(q.toString() + c.toString() + r.toString());
    }
  }
}


function playerChange(canChange){
  console.warn(!ifGameOver(),canChange,!ifGameOver() && canChange );
  if (!(!ifGameOver() && !canChange)) {
    console.log(canChange);
    playerTurnDiv.classList.remove('playerTurn' + playerTurn);


    playerTurn=playerTurn%2+1;

    playerTurnDiv.classList.add('playerTurn' + playerTurn);
    elPlayer.id = 'playerTurn' + playerTurn;

    elPlayer.innerHTML = playerBoxContent + playerTurn;
  }
  else {
    console.warn('did not change playerTurn');
  }
}

function doRotateTwice(q = 0) {
  blocks[q].forEach(function(c, indexC){
    c.forEach(function(r, indexR){
      r.oldStatus = r.status;
    });
  });
  blocks[q].forEach(function(c, indexC){ /*  use jquery and change class styles and classes  */
    c.forEach(function(r, indexR){
        // changing the C x R
      let classNamePathI = q.toString() + (3 - indexC).toString() + (3 - indexR).toString(); // initial after rotation
      let classNamePathF = q.toString() + indexC.toString() + indexR.toString(); // final

      changeStatus(classNamePathI, r); // iffy on this :(
      colorChange(r);


      // so first, i will change the values in blocks
      // then i will change the colors of each block
      // from there, things will go by ear

    });
  });
}

function boardGrid(){  // converts board to 2d array
  blockStatus=[];
  for (let q = 0; q < blocks.length; q++) {
    for (let c = 0; c < blocks[q].length; c++) {
      let cStatus = [];
      for (let r = 0; r < blocks[q][c].length; r++) {
        cStatus.push(blocks[q][c][r].status);
      }
      blockStatus.push(cStatus);
    }
  }

  for (let i=0; i < 4; i++) {
    blockStatus[i+4].forEach(function(item, index) {
      blockStatus[i].push(item);
    });
  }

  blockStatus = blockStatus.slice(0,4).concat(blockStatus.slice(8));
  for (let i=4; i < 8; i++) {
    blockStatus[i+4].forEach(function(item, index){
      blockStatus[i].push(item);
    });
  }
  blockStatus = blockStatus.slice(0,8);
}

function changeStatus(FinalPath,r){ // call near beginning of rotate function
  r.status = blocks[FinalPath[0]][FinalPath[1]][FinalPath[2]].oldStatus;
}

function colorChange(r){
  if (r.status == 0){
    r.el.classList.remove('player1clicked','player2clicked');
  }
  else if (r.status == 1){
    r.el.classList.add('player1clicked');
    r.el.classList.remove('player2clicked');
  }
  else {
    r.el.classList.add('player2clicked');
    r.el.classList.remove('player1clicked');
  }
}


function playerSetStatus(el) {
//  console.error(el.classList.contains('player1clicked'),el.classList.contains('player2clicked'), el.tagName,!el.classList.contains('player1clicked') && !el.classList.contains('player2clicked') && el.tagName != 'DIV');
  if (!el.classList.contains('player1clicked') && !el.classList.contains('player2clicked') && el.tagName != 'DIV') {
    el.classList.add('player' + playerTurn + 'clicked');
    blocks[el.id[0]][el.id[1]][el.id[2]].status = playerTurn;
    blocks[el.id[0]][el.id[1]][el.id[2]].oldStatus = playerTurn;
    // playerChange(); moved to end of big function
    return true;
  }
  return false;
}


function chkLine(a,b,c,d,e) {
    // Check first cell non-zero and all cells match
    return ((a != 0) && (a == b) && (a == c) && (a == d) && (a == e));
}

function chkWinner(bd) {
  winningList = [];
  // Check down
  for (r = 0; r < 4; r++)
    for (c = 0; c < 8; c++)
      if (chkLine(bd[r][c], bd[r+1][c], bd[r+2][c], bd[r+3][c], bd[r+4][c]))
        winningList.push(bd[r][c]);

  // Check right
  for (r = 0; r < 8; r++)
    for (c = 0; c < 5; c++)
      if (chkLine(bd[r][c], bd[r][c+1], bd[r][c+2], bd[r][c+3], bd[r][c+4]))
        winningList.push(bd[r][c]);

  // Check down-right
  for (r = 0; r < 4; r++)
    for (c = 0; c < 4; c++)
      if (chkLine(bd[r][c], bd[r+1][c+1], bd[r+2][c+2], bd[r+3][c+3], bd[r+4][c+4]))
        winningList.push(bd[r][c]);

  // Check down-left
  for (r = 4; r < 8; r++)
    for (c = 0; c < 5; c++)
      if (chkLine(bd[r][c], bd[r-1][c+1], bd[r-2][c+2], bd[r-3][c+3], bd[r-4][c+4]))
        winningList.push(bd[r][c]);
}

function ifGameOver(){ // returns false if game is not over
  // if there are more than one 5 in a row, then whoever has more will win
  winner = [0,0,0];
  if (!(winningList === [])) {
    winningList.forEach(function(winStatus) {
      if (winStatus === 1) {
        winner[0]+=1;
      }
      else {
        winner[1]+=1;
      }
    });
    if (winner[0] > winner[1]) {
      winner[2] = 1;
      return true;
    }
    else if (winner[1] > winner[0]) {
      winner[2] = 2;
      return true;
    }
    else {
      winner[2] = 0;
      return false;
    }
  }
  return false;
}

function rotate(rotations, q=0){
  if (!ifGameOver()) {
    if (rotations == 2)
      doRotateTwice(q);
    else
      console.log('Not yet');

    boardGrid();
    playerChange(true);
    chkWinner(blockStatus);
    console.log(winningList);
  }
  else {
    console.log('GG');
  }
}



document.getElementById('quadrant1').addEventListener('click', function(e) {
  onPieceClick(e);
});
document.getElementById('quadrant2').addEventListener('click', function(e) {
  onPieceClick(e);
});
document.getElementById('quadrant3').addEventListener('click', function(e) {
  onPieceClick(e);
});
document.getElementById('quadrant4').addEventListener('click', function(e) {
  onPieceClick(e);
});


function onGameOver(){
  playerTurn=playerTurn%2+1;
  playerTurnDiv.classList.remove('playerTurn' + playerTurn);
  playerTurnDiv.classList.add('gameOver'+ playerTurn);
  elPlayer.id = 'gameOver' + playerTurn;
  elPlayer.innerHTML = gameOverMessage() + '<br role=\'presentation\'> Refresh Page to begin again';
}

function gameOverMessage(){ // will use switch case later
  return 'Game Over! Player ' + playerTurn + ' has won!';
}

function onPieceClick(e){
  let el = e.target;
  if (!ifGameOver()) {
    console.log(ifGameOver());
    let canChange = playerSetStatus(el);
    boardGrid();
    chkWinner(blockStatus);
    playerChange(canChange);
    console.log(winningList);
    console.log(ifGameOver());
  }
  else {
    console.log('GG');
    console.log(ifGameOver());
  }
  if (ifGameOver()){
    console.log('yay', ifGameOver());
    onGameOver();
  }



}

    </script>
  </body>
</html>
